# Gnosis MCP — Full Reference

> MCP server for PostgreSQL documentation with pgvector search.
> PyPI: gnosis-mcp | CLI: gnosis-mcp | Import: gnosis_mcp

## Install

```bash
pip install gnosis-mcp
```

## Quick Setup

```bash
export GNOSIS_MCP_DATABASE_URL="postgresql://user:pass@localhost:5432/mydb"
gnosis-mcp init-db    # Create tables (idempotent)
gnosis-mcp check      # Verify connection + schema
```

## MCP Client Config

```json
{
  "mcpServers": {
    "docs": {
      "command": "gnosis-mcp",
      "args": ["serve"],
      "env": {
        "GNOSIS_MCP_DATABASE_URL": "postgresql://user:pass@localhost:5432/mydb"
      }
    }
  }
}
```

Config file locations:
- Claude Code: `.claude/mcp.json`
- Cursor: `.cursor/mcp.json`
- Windsurf: `~/.codeium/windsurf/mcp_config.json`
- Cline: Cline MCP settings panel

## Tools (6)

### Read Tools (always available)

1. **search_docs(query, category?, limit?)** — Search docs using keyword (tsvector) or hybrid semantic+keyword search.
   - query: string (required) — search text
   - category: string (optional) — filter by category
   - limit: int (default 5, max configurable) — result count

2. **get_doc(path, max_length?)** — Get full document by file path. Reassembles chunks in order.
   - path: string (required) — e.g. "guides/quickstart.md"
   - max_length: int (optional) — truncate at N characters

3. **get_related(path)** — Find related documents via bidirectional link graph.
   - path: string (required)

### Write Tools (require GNOSIS_MCP_WRITABLE=true)

4. **upsert_doc(path, content, title?, category?, audience?, tags?)** — Insert or replace document. Auto-chunks at paragraph boundaries.

5. **delete_doc(path)** — Delete document, its chunks, and links.

6. **update_metadata(path, title?, category?, audience?, tags?)** — Update metadata fields on all chunks.

## Resources (3)

- **gnosis://docs** — List all documents with title, category, chunk count
- **gnosis://docs/{path}** — Read document content by path
- **gnosis://categories** — List categories with document counts

## Configuration (Environment Variables)

All settings via GNOSIS_MCP_* environment variables. Only DATABASE_URL is required.

### Core Settings
- GNOSIS_MCP_DATABASE_URL — PostgreSQL connection string (falls back to DATABASE_URL)
- GNOSIS_MCP_SCHEMA — Database schema (default: public)
- GNOSIS_MCP_CHUNKS_TABLE — Chunks table name, comma-separated for multi-table (default: documentation_chunks)
- GNOSIS_MCP_LINKS_TABLE — Links table name (default: documentation_links)
- GNOSIS_MCP_SEARCH_FUNCTION — Custom search function e.g. internal.search_docs (default: none, uses built-in tsvector)
- GNOSIS_MCP_EMBEDDING_DIM — Embedding vector dimension for init-db (default: 1536)
- GNOSIS_MCP_POOL_MIN — Min pool connections (default: 1)
- GNOSIS_MCP_POOL_MAX — Max pool connections (default: 3)
- GNOSIS_MCP_WRITABLE — Enable write tools: true/1/yes (default: false)
- GNOSIS_MCP_WEBHOOK_URL — URL to POST on doc changes (default: none)

### Tuning
- GNOSIS_MCP_CONTENT_PREVIEW_CHARS — Characters in search previews, min 50 (default: 200)
- GNOSIS_MCP_CHUNK_SIZE — Max chars per chunk, min 500 (default: 4000)
- GNOSIS_MCP_SEARCH_LIMIT_MAX — Max search result limit, min 1 (default: 20)
- GNOSIS_MCP_WEBHOOK_TIMEOUT — Webhook timeout seconds, min 1 (default: 5)
- GNOSIS_MCP_TRANSPORT — Server transport: stdio or sse (default: stdio)
- GNOSIS_MCP_LOG_LEVEL — Logging: DEBUG/INFO/WARNING/ERROR/CRITICAL (default: INFO)

### Column Overrides (for existing tables with non-standard names)
- GNOSIS_MCP_COL_FILE_PATH (default: file_path)
- GNOSIS_MCP_COL_TITLE (default: title)
- GNOSIS_MCP_COL_CONTENT (default: content)
- GNOSIS_MCP_COL_CHUNK_INDEX (default: chunk_index)
- GNOSIS_MCP_COL_CATEGORY (default: category)
- GNOSIS_MCP_COL_AUDIENCE (default: audience)
- GNOSIS_MCP_COL_TAGS (default: tags)
- GNOSIS_MCP_COL_EMBEDDING (default: embedding)
- GNOSIS_MCP_COL_TSV (default: tsv)
- GNOSIS_MCP_COL_SOURCE_PATH (default: source_path)
- GNOSIS_MCP_COL_TARGET_PATH (default: target_path)
- GNOSIS_MCP_COL_RELATION_TYPE (default: relation_type)

## Custom Search Function

Your function must accept:
```sql
(p_query_text text, p_categories text[], p_limit integer)
```

And return columns: file_path, title, content, category, combined_score.

## CLI

```
gnosis-mcp serve [--transport stdio|sse]   # Start MCP server
gnosis-mcp init-db [--dry-run]             # Create tables (or preview SQL)
gnosis-mcp check                           # Verify connection + schema
gnosis-mcp --version                       # Show version
```

## Architecture

```
src/gnosis_mcp/
├── config.py   # GnosisMcpConfig frozen dataclass, env var loading, validation
├── db.py       # asyncpg pool + FastMCP lifespan context manager
├── server.py   # FastMCP server: 6 tools + 3 resources + webhook helper
├── schema.py   # SQL template for init-db (chunks + links tables)
└── cli.py      # argparse CLI: serve, init-db, check
```

Dependencies: mcp>=1.20, asyncpg>=0.29 (2 total).

## License

MIT — https://github.com/nicholasglazer/gnosis-mcp
